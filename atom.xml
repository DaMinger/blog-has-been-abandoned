<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[DaMinger's blog]]></title>
  <subtitle><![CDATA[信春哥，系统稳，闭眼上线不回滚]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="https://github.com/DaMinger/DaMinger.github.io.git/"/>
  <updated>2014-04-10T12:47:01.646Z</updated>
  <id>https://github.com/DaMinger/DaMinger.github.io.git/</id>
  
  <author>
    <name><![CDATA[DaMinger]]></name>
    <email><![CDATA[564400632@qq.com]]></email>
  </author>
  
  <generator uri="http://zespia.tw/hexo/">Hexo</generator>
  
  <entry>
    <title><![CDATA[三次握手，四次挥手]]></title>
    <link href="https://github.com/DaMinger/DaMinger.github.io.git/2014/04/10/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/internet_1/"/>
    <id>https://github.com/DaMinger/DaMinger.github.io.git/2014/04/10/计算机网络/internet_1/</id>
    <published>2014-04-10T11:47:37.000Z</published>
    <updated>2014-04-10T12:44:22.000Z</updated>
    <content type="html"><![CDATA[<h1 id="一、TCP报文格式">一、TCP报文格式</h1>
<p>下面是TCP报文格式图：<br><img src="/img/Internet/Internet_1.png" alt="图1 TCP报文格式"><br>上图中有几个字段需要重点介绍下：<br>（1）序号：Seq序号，占32位，用来标识从TCP源端向目的端发送的字节流，发起方发送数据时对此进行标记。<br>（2）确认序号：Ack序号，占32位，只有ACK标志位为1时，确认序号字段才有效，Ack=Seq+1。<br>（3）标志位：共6个，即URG、ACK、PSH、RST、SYN、FIN等，具体含义如下：<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;（A）URG：紧急指针（urgent pointer）有效。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;（B）ACK：确认序号有效。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;（C）PSH：接收方应该尽快将这个报文交给应用层。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;（D）RST：重置连接。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;（E）SYN：发起一个新连接。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;（F）FIN：释放一个连接。<br>需要注意的是：<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;（A）不要将确认序号Ack与标志位中的ACK搞混了。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;（B）确认方Ack=发起方Req+1，两端配对。 </p>
<h1 id="二、三次握手">二、三次握手</h1>
<p>所谓三次握手（Three-Way Handshake）即建立TCP连接，就是指建立一个TCP连接时，需要客户端和服务端总共发送3个包以确认连接的建立。在socket编程中，这一过程由客户端执行connect来触发，整个流程如下图所示：<br><img src="/img/Internet/Internet_2.png" alt="图2 TCP三次握手"><br>（1）第一次握手：Client将标志位SYN置为1，随机产生一个值seq=J，并将该数据包发送给Server，Client进入SYN_SENT状态，等待Server确认。<br>（2）第二次握手：Server收到数据包后由标志位SYN=1知道Client请求建立连接，Server将标志位SYN和ACK都置为1，ack=J+1，随机产生一个值seq=K，并将该数据包发送给Client以确认连接请求，Server进入SYN_RCVD状态。<br>（3）第三次握手：Client收到确认后，检查ack是否为J+1，ACK是否为1，如果正确则将标志位ACK置为1，ack=K+1，并将该数据包发送给Server，Server检查ack是否为K+1，ACK是否为1，如果正确则连接建立成功，Client和Server进入ESTABLISHED状态，完成三次握手，随后Client与Server之间可以开始传输数据了。</p>
<p>SYN攻击：<br>在三次握手过程中，Server发送SYN-ACK之后，收到Client的ACK之前的TCP连接称为半连接（half-open connect），此时Server处于SYN_RCVD状态，当收到ACK后，Server转入ESTABLISHED状态。SYN攻击就是Client在短时间内伪造大量不存在的IP地址，并向Server不断地发送SYN包，Server回复确认包，并等待Client的确认，由于源地址是不存在的，因此，Server需要不断重发直至超时，这些伪造的SYN包将产时间占用未连接队列，导致正常的SYN请求因为队列满而被丢弃，从而引起网络堵塞甚至系统瘫痪。SYN攻击时一种典型的DDOS攻击，检测SYN攻击的方式非常简单，即当Server上有大量半连接状态且源IP地址是随机的，则可以断定遭到SYN攻击了，使用如下命令可以让之现行：</p>
<pre><code><span class="preprocessor">#netstat -nap | grep SYN_RECV</span>
</code></pre><h1 id="三、四次挥手">三、四次挥手</h1>
<p>三次握手耳熟能详，四次挥手估计就不太熟了，所谓四次挥手（Four-Way Wavehand）即终止TCP连接，就是指断开一个TCP连接时，需要客户端和服务端总共发送4个包以确认连接的断开。在socket编程中，这一过程由客户端或服务端任一方执行close来触发，整个流程如下图所示<br><img src="/img/Internet/Internet_3.png" alt="图3 TCP四次挥手"></p>
<p>由于TCP连接时全双工的，因此，每个方向都必须要单独进行关闭，这一原则是当一方完成数据发送任务后，发送一个FIN来终止这一方向的连接，收到一个FIN只是意味着这一方向上没有数据流动了，即不会再收到数据了，但是在这个TCP连接上仍然能够发送数据，直到这一方向也发送了FIN。首先进行关闭的一方将执行主动关闭，而另一方则执行被动关闭，上图描述的即是如此。<br>（1）第一次挥手：Client发送一个FIN，用来关闭Client到Server的数据传送，Client进入FIN_WAIT_1状态。<br>（2）第二次挥手：Server收到FIN后，发送一个ACK给Client，确认序号为收到序号+1（与SYN相同，一个FIN占用一个序号），Server进入CLOSE_WAIT状态。<br>（3）第三次挥手：Server发送一个FIN，用来关闭Server到Client的数据传送，Server进入LAST_ACK状态。<br>（4）第四次挥手：Client收到FIN后，Client进入TIME_WAIT状态，接着发送一个ACK给Server，确认序号为收到序号+1，Server进入CLOSED状态，完成四次挥手。</p>
<p> 上面是一方主动关闭，另一方被动关闭的情况，实际中还会出现同时发起主动关闭的情况，具体流程如下图<br><img src="/img/Internet/Internet_4.png" alt="图4 同时挥手"></p>
<h1 id="四、附注">四、附注</h1>
<p>关于三次握手与四次挥手通常都会有典型的面试题，在此提出供有需求的同学们参考：<br>（1）三次握手是什么或者流程？四次握手呢？答案前面分析就是。<br>（2）为什么建立连接是三次握手，而关闭连接却是四次挥手呢？</p>
<p> 这是因为服务端在LISTEN状态下，收到建立连接请求的SYN报文后，把ACK和SYN放在一个报文里发送给客户端。而关闭连接时，当收到对方的FIN报文时，仅仅表示对方不再发送数据了但是还能接收数据，己方也未必全部数据都发送给对方了，所以己方可以立即close，也可以发送一些数据给对方后，再发送FIN报文给对方来表示同意现在关闭连接，因此，己方ACK和FIN一般都会分开发送。        </p>
<p> <a href="http://blog.chinaunix.net/uid-7411781-id-3812206.html" target="_blank">   原文链接，请点击这里    </a></p>
]]></content>
    
    
      <category term="网络" scheme="https://github.com/DaMinger/DaMinger.github.io.git/tags/%E7%BD%91%E7%BB%9C/"/>
    
      <category term="计算机网络" scheme="https://github.com/DaMinger/DaMinger.github.io.git/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[在Linux CentOS6.3下编译安装MySQL5.6.10]]></title>
    <link href="https://github.com/DaMinger/DaMinger.github.io.git/2014/04/09/Linux/linux_mysql_install/"/>
    <id>https://github.com/DaMinger/DaMinger.github.io.git/2014/04/09/Linux/linux_mysql_install/</id>
    <published>2014-04-09T12:15:51.000Z</published>
    <updated>2014-04-09T12:42:15.000Z</updated>
    <content type="html"><![CDATA[<h2 id="一、编译安装MySQL前的准备工作">一、编译安装MySQL前的准备工作</h2>
<pre><code>安装编译源码所需的工具和库
yum install gcc gcc-c++ ncurses-devel perl
安装cmake，从http://www<span class="preprocessor">.cmake</span><span class="preprocessor">.org</span>下载源码并编译安装
wget http://www<span class="preprocessor">.cmake</span><span class="preprocessor">.org</span>/files/v2<span class="number">.8</span>/cmake-<span class="number">2.8</span><span class="number">.10</span><span class="number">.2</span><span class="preprocessor">.tar</span><span class="preprocessor">.gz</span>
tar -xzvf cmake-<span class="number">2.8</span><span class="number">.10</span><span class="number">.2</span><span class="preprocessor">.tar</span><span class="preprocessor">.gz</span>
cd cmake-<span class="number">2.8</span><span class="number">.10</span><span class="number">.2</span>
./bootstrap <span class="comment">; make ; make install</span>
cd ~
</code></pre><h2 id="二、设置MySQL用户和组">二、设置MySQL用户和组</h2>
<pre><code>新增mysql用户组
groupadd mysql
新增mysql用户
useradd <span class="attribute">-r</span> <span class="attribute">-g</span> mysql mysql
</code></pre><h2 id="三、新建MySQL所需要的目录">三、新建MySQL所需要的目录</h2>
<pre><code>新建mysql安装目录
mkdir <span class="attribute">-p</span> /usr/<span class="built_in">local</span>/mysql
新建mysql数据库数据文件目录
mkdir <span class="attribute">-p</span> /<span class="built_in">data</span>/mysqldb
</code></pre><h2 id="四、下载MySQL源码包并解压">四、下载MySQL源码包并解压</h2>
<pre><code>从http://dev<span class="preprocessor">.mysql</span><span class="preprocessor">.com</span>/downloads/mysql/直接下载源码
解压mysql-<span class="number">5.6</span><span class="number">.10</span><span class="preprocessor">.tar</span><span class="preprocessor">.gz</span>
tar -zxv -f mysql-<span class="number">5.6</span><span class="number">.10</span><span class="preprocessor">.tar</span><span class="preprocessor">.gz</span>
cd mysql-<span class="number">5.6</span><span class="number">.10</span>
</code></pre><h2 id="五、编译安装MySQL">五、编译安装MySQL</h2>
<pre><code>从mysql5.5起，mysql源码安装开始使用cmake了，设置源码编译配置脚本。
-<span class="ruby"><span class="constant">DCMAKE_INSTALL_PREFIX</span>=dir_name    设置mysql安装目录
</span>-<span class="ruby"><span class="constant">DMYSQL_UNIX_ADDR</span>=file_name    设置监听套接字路径，这必须是一个绝对路径名。默认为/tmp/mysql.sock的中。
</span>-<span class="ruby"><span class="constant">DDEFAULT_CHARSET</span>=charset_name    设置服务器的字符集。缺省情况下，<span class="constant">MySQL</span>使用latin1的（<span class="constant">CP1252</span>西欧）字符集。
</span>cmake/character_sets.cmake文件包含允许的字符集名称列表。
-<span class="ruby"><span class="constant">DDEFAULT_COLLATION</span>=collation_name    设置服务器的排序规则。
</span>-<span class="ruby"><span class="constant">DWITH_INNOBASE_STORAGE_ENGINE</span>=<span class="number">1</span>
</span>-<span class="ruby"><span class="constant">DWITH_ARCHIVE_STORAGE_ENGINE</span>=<span class="number">1</span>
</span>-<span class="ruby"><span class="constant">DWITH_BLACKHOLE_STORAGE_ENGINE</span>=<span class="number">1</span>
</span>-<span class="ruby"><span class="constant">DWITH_PERFSCHEMA_STORAGE_ENGINE</span>=<span class="number">1</span>    存储引擎选项：
</span>MyISAM，MERGE，MEMORY，和CSV引擎是默认编译到服务器中，并不需要明确地安装。
静态编译一个存储引擎到服务器，使用-DWITH_engine_STORAGE_ENGINE= 1。
可用的存储引擎值有：ARCHIVE, BLACKHOLE, EXAMPLE, FEDERATED, INNOBASE (InnoDB),   PARTITION (partitioning support), 和 PERFSCHEMA (Performance Schema).
-<span class="ruby"><span class="constant">DMYSQL_DATADIR</span>=dir_name    设置mysql数据库文件目录
</span>-<span class="ruby"><span class="constant">DMYSQL_TCP_PORT</span>=port_num    设置mysql服务器监听端口，默认为<span class="number">3306</span>
</span>-<span class="ruby"><span class="constant">DENABLE_DOWNLOADS</span>=bool    是否要下载可选的文件。例如，启用此选项（设置为<span class="number">1</span>），cmake将下载谷歌所使用的测试套件运行单元测试。
</span>设置编译参数
cmake \
-<span class="ruby"><span class="constant">DCMAKE_INSTALL_PREFIX</span>=<span class="regexp">/usr/local</span><span class="regexp">/mysql \
</span></span>-<span class="ruby"><span class="constant">DMYSQL_UNIX_ADDR</span>=<span class="regexp">/usr/local</span><span class="regexp">/mysql/mysql</span>.sock \
</span>-<span class="ruby"><span class="constant">DDEFAULT_CHARSET</span>=utf8 \
</span>-<span class="ruby"><span class="constant">DDEFAULT_COLLATION</span>=utf8_general_ci \
</span>-<span class="ruby"><span class="constant">DWITH_INNOBASE_STORAGE_ENGINE</span>=<span class="number">1</span> \
</span>-<span class="ruby"><span class="constant">DWITH_ARCHIVE_STORAGE_ENGINE</span>=<span class="number">1</span> \
</span>-<span class="ruby"><span class="constant">DWITH_BLACKHOLE_STORAGE_ENGINE</span>=<span class="number">1</span> \
</span>-<span class="ruby"><span class="constant">DMYSQL_DATADIR</span>=<span class="regexp">/data/mysqldb</span> \
</span>-<span class="ruby"><span class="constant">DMYSQL_TCP_PORT</span>=<span class="number">3306</span> \
</span>-<span class="ruby"><span class="constant">DENABLE_DOWNLOADS</span>=<span class="number">1</span>
</span>注：重新运行配置，需要删除CMakeCache.txt文件
rm CMakeCache.txt
编译源码
make
安装
make install
</code></pre><h2 id="六、修改mysql目录所有者和组">六、修改mysql目录所有者和组</h2>
<pre><code>修改mysql安装目录
cd /usr/<span class="built_in">local</span>/mysql
chown <span class="attribute">-R</span> mysql:mysql <span class="built_in">.</span>
修改mysql数据库文件目录
cd /<span class="built_in">data</span>/mysqldb
chown <span class="attribute">-R</span> mysql:mysql <span class="built_in">.</span>
</code></pre><h2 id="七、初始化mysql数据库">七、初始化mysql数据库</h2>
<pre><code><span class="comment">cd</span> <span class="comment">/usr/local/mysql</span>
<span class="comment">scripts/mysql_install_db</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">user=mysql</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">datadir=/data/mysqldb</span>
</code></pre><h2 id="八、复制mysql服务启动配置文件">八、复制mysql服务启动配置文件</h2>
<pre><code>cp /usr/<span class="keyword">local</span>/mysql/support-files/<span class="keyword">my</span>-default.cnf /etc/<span class="keyword">my</span>.cnf
注：如果/etc/<span class="keyword">my</span>.cnf文件存在，则覆盖。
</code></pre><h2 id="九、复制mysql服务启动脚本及加入PATH路径">九、复制mysql服务启动脚本及加入PATH路径</h2>
<pre><code>cp support-files/mysql.server /etc/init.d/mysqld
vim /etc/profile
<span class="constant">PATH</span>=<span class="regexp">/usr/local</span><span class="regexp">/mysql/bin</span><span class="symbol">:/usr/local/mysql/lib</span><span class="symbol">:</span><span class="variable">$PATH</span>
export <span class="constant">PATH</span>
source /etc/profile
</code></pre><h2 id="十、启动mysql服务并加入开机自启动">十、启动mysql服务并加入开机自启动</h2>
<pre><code>service mysqld <span class="operator"><span class="keyword">start</span>
chkconfig --<span class="keyword">level</span> <span class="number">35</span> mysqld <span class="keyword">on</span></span>
</code></pre><h2 id="十一、检查mysql服务是否启动">十一、检查mysql服务是否启动</h2>
<pre><code>netstat <span class="attribute">-tulnp</span> <span class="subst">|</span> grep <span class="number">3306</span>
mysql <span class="attribute">-u</span> root <span class="attribute">-p</span>
密码为空，如果能登陆上，则安装成功。
</code></pre><h2 id="十二、修改MySQL用户root的密码">十二、修改MySQL用户root的密码</h2>
<pre><code>mysqladmin <span class="attribute">-u</span> root password <span class="string">'123456'</span>
注：也可运行安全设置脚本，修改MySQL用户root的密码，同时可禁止root远程连接，移除test数据库和匿名用户。
/usr/<span class="built_in">local</span>/mysql/bin/mysql_secure_installation
</code></pre><h2 id="十三、可能会出现的错误">十三、可能会出现的错误</h2>
<pre><code>问题：
Starting MySQL..The server quit <span class="keyword">without</span> updating PID <span class="type">file</span> ([FAILED]/mysql/Server03.mylinux.com.pid).
解决：
修改/etc/<span class="keyword">my</span>.cnf 中datadir,指向正确的mysql数据库文件目录

问题：
ERROR <span class="number">2002</span> (HY000): Can't connect <span class="keyword">to</span> <span class="keyword">local</span> MySQL server <span class="keyword">through</span> socket '/tmp/mysql.sock' (<span class="number">2</span>)
解决：
新建一个链接或在mysql中加入-S参数，直接指出mysql.sock位置。
ln -s /usr/<span class="keyword">local</span>/mysql/data/mysql.sock /tmp/mysql.sock
/usr/<span class="keyword">local</span>/mysql/bin/mysql -u root -S /usr/<span class="keyword">local</span>/mysql/data/mysql.sock
</code></pre>]]></content>
    
    
      <category term="Linux" scheme="https://github.com/DaMinger/DaMinger.github.io.git/tags/Linux/"/>
    
      <category term="Mysql" scheme="https://github.com/DaMinger/DaMinger.github.io.git/tags/Mysql/"/>
    
      <category term="Linux" scheme="https://github.com/DaMinger/DaMinger.github.io.git/categories/Linux/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[CENTOS 6.5搭建本地YUM源]]></title>
    <link href="https://github.com/DaMinger/DaMinger.github.io.git/2014/04/09/Linux/linux_yum/"/>
    <id>https://github.com/DaMinger/DaMinger.github.io.git/2014/04/09/Linux/linux_yum/</id>
    <published>2014-04-09T12:01:08.000Z</published>
    <updated>2014-04-09T12:13:21.000Z</updated>
    <content type="html"><![CDATA[<h1 id="CENTOS_6-5搭建本地YUM源">CENTOS 6.5搭建本地YUM源</h1>
<h2 id="方法一：用系统光盘镜像创建">方法一：用系统光盘镜像创建</h2>
<h3 id="1）创建yum源目录并挂载系统光盘镜像">1）创建yum源目录并挂载系统光盘镜像</h3>
<p>mkdir /opt/local-mirror</p>
<p>mount /dev/cdrom  /opt/local-mirror</p>
<h3 id="2)新建local-mirror-repo文件">2)新建local-mirror.repo文件</h3>
<p>cd /etc/yum.repos.d/</p>
<p>rm -f  *  (删掉原来的repo文件，如果以后还想用，也可以重命名或者移到其他目录，我这里删掉)</p>
<p>vi /etc/yum.repos.d/local-mirror.repo</p>
<pre><code><span class="title">[local-mirror]</span>
<span class="setting">name=<span class="value">This is a local repo</span></span>
<span class="setting">baseurl=<span class="value">file:///opt/local-mirror</span></span>
<span class="setting">enabled=<span class="value"><span class="number">1</span></span></span>
<span class="setting">gpgcheck=<span class="value"><span class="number">1</span></span></span>
<span class="setting">gpgkey=<span class="value">file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-<span class="number">6</span></span></span>
</code></pre><h3 id="3)设置开机自动挂载">3)设置开机自动挂载</h3>
<p>vi  /etc/fstab   //在最后一行加上：</p>
<pre><code>/dev/cdrom    /opt/local-mirror     iso9660        <span class="default"><span class="keyword">default</span>      0    0</span>
</code></pre><h3 id="4)测试">4)测试</h3>
<p>yum clean all</p>
<p>yum  makecache</p>
<p>yum -y install ftp(或者安装其他软件包)</p>
<p>如果没有提示错误，就说明本地yum源搭建成功了！</p>
<h2 id="方法二：将所有rpm包复制到指定文件夹，通过createrepo命令创建">方法二：将所有rpm包复制到指定文件夹，通过createrepo命令创建</h2>
<h3 id="1）创建yum源目录并且挂载系统光盘镜像之后，将所有rpm包复制到yum源目录，如果镜像文件像CentOS6-5一样是分为2个iso文件的，分2次挂载并且复制即可">1）创建yum源目录并且挂载系统光盘镜像之后，将所有rpm包复制到yum源目录，如果镜像文件像CentOS6.5一样是分为2个iso文件的，分2次挂载并且复制即可</h3>
<p>mkdir /opt/local-mirror</p>
<p>mount /dev/cdrom  /mnt (临时供copy的目录）</p>
<p>cp /mnt/Packages/*   /opt/local-mirror</p>
<h3 id="2)通过rpm命令手动安装createrepo命令创建yum仓库">2)通过rpm命令手动安装createrepo命令创建yum仓库</h3>
<p>rpm -ivh createrepo     (若提示需要安装依赖包，根据提示安装即可）</p>
<p>createrepo -v  /opt/local-mirror  (创建索引信息）</p>
<h3 id="3）同方法一的第二步">3）同方法一的第二步</h3>
<h3 id="4）测试同方法一的第四步">4）测试同方法一的第四步</h3>
]]></content>
    
    
      <category term="Linux" scheme="https://github.com/DaMinger/DaMinger.github.io.git/tags/Linux/"/>
    
      <category term="yum" scheme="https://github.com/DaMinger/DaMinger.github.io.git/tags/yum/"/>
    
      <category term="Linux" scheme="https://github.com/DaMinger/DaMinger.github.io.git/categories/Linux/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[第一篇Blog都是扯淡]]></title>
    <link href="https://github.com/DaMinger/DaMinger.github.io.git/2014/04/07/%E6%9D%82%E8%B0%88/first_blog/"/>
    <id>https://github.com/DaMinger/DaMinger.github.io.git/2014/04/07/杂谈/first_blog/</id>
    <published>2014-04-07T04:18:40.000Z</published>
    <updated>2014-04-09T09:05:06.000Z</updated>
    <content type="html"><![CDATA[<p>所谓的第一篇文章都是扯淡，原先学习都是用OneNote来管理个人笔记，现在整个Blog分享点学习心得,共享知识，共同进步。</p>
]]></content>
    
    
      <category term="杂谈" scheme="https://github.com/DaMinger/DaMinger.github.io.git/tags/%E6%9D%82%E8%B0%88/"/>
    
      <category term="杂谈" scheme="https://github.com/DaMinger/DaMinger.github.io.git/categories/%E6%9D%82%E8%B0%88/"/>
    
  </entry>
  
</feed>
